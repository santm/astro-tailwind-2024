---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Container from "../../components/Container.astro";
const pageTitle = "Blog Posts";
import { getCollection } from "astro:content";
const allPosts_year = await getCollection("blog");
const postYears = [...new Set(allPosts_year.flatMap(post => post.data.pubDate.getFullYear()))];
const yearPostCount: { [year: number]: number } = {};
allPosts_year.forEach(post => {
  const year = post.data.pubDate.getFullYear();
  yearPostCount[year] = (yearPostCount[year] || 0) + 1;
});
import Paginator from "../../components/Paginator.astro" ;
import BlogListing from "../../components/BlogListing.astro" ;
export async function getStaticPaths({ paginate }: any) {
const allPosts = (await getCollection('blog'));    
const sortedPosts = allPosts.sort((a, b) => {
  const dateA = new Date(a.data.pubDate) as any; // Explicitly specify the type
  const dateB = new Date(b.data.pubDate) as any; // Explicitly specify the type

  return dateB - dateA;
});
return paginate(sortedPosts, {
      pageSize: 10
    })
}

const { page } = Astro.props
---
<BaseLayout>
    <main class="space-y-40 mb-40">
        <div class="relative" id="blog">
          <div aria-hidden="true" class="absolute inset-0 grid grid-cols-2 -space-x-52 opacity-40 dark:opacity-20">
            <div class="blur-[106px] h-56 bg-gradient-to-br from-primary to-purple-400 dark:from-blue-700"></div>
            <div class="blur-[106px] h-32 bg-gradient-to-r from-cyan-400 to-sky-300 dark:to-indigo-600"></div>
          </div>
          <Container>
            <div class="relative pt-36 ml-auto">
              <h1 class="pb-4 text-4xl md:text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500">
                Blog Posts
                </h1>
              <div class="prose max-w-none">All the blog posts so far</div>
              <div class="grid lg:grid-cols-3 gap-y-8 lg:gap-y-0 lg:gap-x-6 xl:gap-x-12">
      <!-- Content -->
      <div class="lg:col-span-2">
        <div class="py-8 lg:pr-8">
          <div class="space-y-5 lg:space-y-8">
            
            <BlogListing posts={page.data} /> 
            <!--  santm 
            Type '{ posts: any; }' is not assignable to type 'IntrinsicAttributes & Props'.
  Property 'posts' does not exist on type 'IntrinsicAttributes & Props'. Did you mean 'post'?
  Property 'data' does not exist on type 'never'.
  santm - no easy fix whatever I tried broke things 
            -->

            
            <Paginator page={page} />
            
          </div>
        </div>
      </div>
      <!-- End Content -->
  
      <!-- Sidebar -->
      <div class="hidden lg:block lg:col-span-1 lg:w-full lg:h-full">
        <div class="sticky top-0 left-0 py-8 lg:pl-4">
          <ul class="space-y-2">
            {postYears.reverse().flatMap((year) => (
                <li class="prose md:prose-lg lg:prose-xl dark:prose-invert max-w-none"><a  href={`/years/${year}/`} title={`View "${ yearPostCount[year] }" posts for "${year}"`}>{year}</a><span class="hidden lg:inline text-[9px] sub"> ({ yearPostCount[year]})</span> </li>
            ))}
        </ul>
        </div>
        </div>
      </div>
      <!-- End Sidebar -->
    </div>
            </div>
            

              
          </Container>
        </div>
    </main>
</BaseLayout>

